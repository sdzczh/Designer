{"title":"将UniswapV2部署到所有区块链--去中心化交易所Uniswap多链部署","uid":"ef6e40d56e038ad562533ff3b6321d26","slug":"将UniswapV2部署到所有区块链-去中心化交易所Uniswap多链部署/index","date":"2022-03-26T14:52:50.000Z","updated":"2022-03-27T03:17:16.739Z","comments":true,"path":"api/articles/将UniswapV2部署到所有区块链-去中心化交易所Uniswap多链部署/index.json","keywords":null,"cover":[],"content":"<h1 id=\"准备工作\"><a href=\"#准备工作\" class=\"headerlink\" title=\"准备工作\"></a>准备工作</h1><h3 id=\"工厂合约\"><a href=\"#工厂合约\" class=\"headerlink\" title=\"工厂合约\"></a>工厂合约</h3><p><a href=\"https://cn.etherscan.com/address/0x5C69bEe701ef814a2B6a3EDD4B1652CB9cc5aA6f#code\">工厂合约链接</a></p>\n<p>在主合约添加</p>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">bytes32 public constant INIT_CODE_PAIR_HASH &#x3D; keccak256(abi.encodePacked(type(UniswapV2Pair).creationCode));<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<p>编译EVM版本选择<code>istanbul</code>，优化次数999999。<br>构造参数为管理员地址。</p>\n<img src=\"https://raw.githubusercontent.com/sdzczh/gitalk/master/uPic/16483477610156.jpg\" alt=\"图片替换文本\" width=\"200\" height=\"auto\">\n\n<h3 id=\"路由合约\"><a href=\"#路由合约\" class=\"headerlink\" title=\"路由合约\"></a>路由合约</h3><p><a href=\"https://cn.etherscan.com/address/0x7a250d5630b4cf539739df2c5dacb4c659f2488d#code\">路由合约链接</a></p>\n<p>全局搜索hex，根据工厂合约查询到的<code>INIT_CODE_PAIR_HASH</code>的值，替换到路由合约中。<br>构造参数为工厂合约地址和WETH地址。<br><img src=\"https://raw.githubusercontent.com/sdzczh/gitalk/master/uPic/16483479537225.jpg\"></p>\n<h3 id=\"WETH合约\"><a href=\"#WETH合约\" class=\"headerlink\" title=\"WETH合约\"></a>WETH合约</h3><p><a href=\"https://cn.etherscan.com/address/0xC02aaA39b223FE8D0A0e5C4F27eAD9083C756Cc2#code\">合约链接地址</a></p>\n<h3 id=\"Multicall合约\"><a href=\"#Multicall合约\" class=\"headerlink\" title=\"Multicall合约\"></a>Multicall合约</h3><p><a href=\"https://cn.etherscan.com/address/0x5e227ad1969ea493b43f840cff78d08a6fc17796#code\">合约链接地址</a></p>\n<h1 id=\"前端工作\"><a href=\"#前端工作\" class=\"headerlink\" title=\"前端工作\"></a>前端工作</h1><h3 id=\"uniswap-sdk\"><a href=\"#uniswap-sdk\" class=\"headerlink\" title=\"uniswap-sdk\"></a>uniswap-sdk</h3><blockquote><span class=\"custom-blockquote-svg\"><svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"\" xmlns=\"http://www.w3.org/2000/svg\" data-reactroot=\"\">\n<path fill=\"\" d=\"M22 12C22 6.5 17.5 2 12 2C6.5 2 2 6.5 2 12C2 17.5 6.5 22 12 22C13.8 22 15.5 21.5 17 20.6L22 22L20.7 17C21.5 15.5 22 13.8 22 12Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\" undefined=\"1\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M17 8.5C15.23 8.97 14.07 10.84 14.01 13.27C14 13.33 14 13.4 14 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M9 8.5C7.23 8.97 6.07 10.84 6.01 13.27C6 13.33 6 13.4 6 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\"></path>\n</svg>\n</span><p>建议使用2020.8.6版本的</p></blockquote>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">git clone https:&#x2F;&#x2F;github.com&#x2F;Uniswap&#x2F;v2-sdk.git<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<ol>\n<li><p>修改工厂合约地址和Init Code<br><img src=\"https://raw.githubusercontent.com/sdzczh/gitalk/master/uPic/16483484710758.jpg\"></p>\n</li>\n<li><p>修改WETH地址<br><img src=\"https://raw.githubusercontent.com/sdzczh/gitalk/master/uPic/16483485256242.jpg\"></p>\n</li>\n<li><p>新增链ID<br><img src=\"https://raw.githubusercontent.com/sdzczh/gitalk/master/uPic/16483485598109.jpg\"></p>\n</li>\n<li><p>修改package.json打包上传npm<br><img src=\"https://raw.githubusercontent.com/sdzczh/gitalk/master/uPic/16483486305240.jpg\"></p>\n</li>\n</ol>\n<p><code>npm login</code></p>\n<p><code>npm publish</code></p>\n<h3 id=\"uniswap前端\"><a href=\"#uniswap前端\" class=\"headerlink\" title=\"uniswap前端\"></a>uniswap前端</h3><p>建议使用2020.9.1版本的</p>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">git clone https:&#x2F;&#x2F;github.com&#x2F;Uniswap&#x2F;uniswap-interface.git<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<ol>\n<li><p>移除uniswap依赖包<br><code>npm remove @uniswap/sdk</code></p>\n</li>\n<li><p>新增sdk依赖<br><code>npm i ll-bsc-sdk</code><br>名称参考上图</p>\n</li>\n<li><p>修改路由合约，增加链名称<br><img src=\"https://raw.githubusercontent.com/sdzczh/gitalk/master/uPic/16483487600264.jpg\"></p>\n</li>\n<li><p>支持的链ID<br><img src=\"https://raw.githubusercontent.com/sdzczh/gitalk/master/uPic/16483489737067.jpg\"></p>\n</li>\n<li><p>新增multicall地址<br><img src=\"https://raw.githubusercontent.com/sdzczh/gitalk/master/uPic/16483490236224.jpg\"></p>\n</li>\n<li><p>修改tokenlist<br><img src=\"https://raw.githubusercontent.com/sdzczh/gitalk/master/uPic/16483490637584.jpg\"></p>\n</li>\n</ol>\n<p>格式如下：</p>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">&#123;\n  &quot;name&quot;: &quot;Default&quot;,\n  &quot;logoURI&quot;: &quot;https:&#x2F;&#x2F;raw.githubusercontent.com&#x2F;compound-finance&#x2F;token-list&#x2F;master&#x2F;assets&#x2F;compound-interface.svg&quot;,\n  &quot;keywords&quot;: [\n    &quot;compound&quot;,\n    &quot;defi&quot;\n  ],\n  &quot;timestamp&quot;: &quot;2021-05-27T20:37:00.000+00:00&quot;,\n  &quot;tokens&quot;: [\n    &#123;\n      &quot;chainId&quot;: 97,\n      &quot;address&quot;: &quot;0x27D55145b209781ccc88D90e1C218f3685fef2c8&quot;,\n      &quot;name&quot;: &quot;dd&quot;,\n      &quot;symbol&quot;: &quot;dd&quot;,\n      &quot;decimals&quot;: 18,\n      &quot;logoURI&quot;: &quot;https:&#x2F;&#x2F;raw.githubusercontent.com&#x2F;compound-finance&#x2F;token-list&#x2F;master&#x2F;assets&#x2F;asset_ZRX.svg&quot;\n    &#125;\n  ],\n  &quot;version&quot;: &#123;\n    &quot;major&quot;: 2,\n    &quot;minor&quot;: 0,\n    &quot;patch&quot;: 0\n  &#125;\n&#125;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<h1 id=\"启动前端\"><a href=\"#启动前端\" class=\"headerlink\" title=\"启动前端\"></a>启动前端</h1><p><code>yarn start</code></p>\n","text":"准备工作工厂合约工厂合约链接 在主合约添加 bytes32 public constant INIT_CODE_PAIR_HASH &#x3D; keccak256(abi.encodePacked(type(UniswapV2Pair).creationCode)); 编译EV...","link":"","photos":[],"count_time":{"symbolsCount":"1.7k","symbolsTime":"2 mins."},"categories":[{"name":"Dapp","slug":"Dapp","count":1,"path":"api/categories/Dapp.json"}],"tags":[{"name":"区块链","slug":"区块链","count":13,"path":"api/tags/区块链.json"},{"name":"Solidity","slug":"Solidity","count":5,"path":"api/tags/Solidity.json"},{"name":"教程","slug":"教程","count":6,"path":"api/tags/教程.json"}],"toc":"<ol class=\"toc\"><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#%E5%87%86%E5%A4%87%E5%B7%A5%E4%BD%9C\"><span class=\"toc-text\">准备工作</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E5%B7%A5%E5%8E%82%E5%90%88%E7%BA%A6\"><span class=\"toc-text\">工厂合约</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E8%B7%AF%E7%94%B1%E5%90%88%E7%BA%A6\"><span class=\"toc-text\">路由合约</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#WETH%E5%90%88%E7%BA%A6\"><span class=\"toc-text\">WETH合约</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#Multicall%E5%90%88%E7%BA%A6\"><span class=\"toc-text\">Multicall合约</span></a></li></ol></li></ol></li><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#%E5%89%8D%E7%AB%AF%E5%B7%A5%E4%BD%9C\"><span class=\"toc-text\">前端工作</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#uniswap-sdk\"><span class=\"toc-text\">uniswap-sdk</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#uniswap%E5%89%8D%E7%AB%AF\"><span class=\"toc-text\">uniswap前端</span></a></li></ol></li></ol></li><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#%E5%90%AF%E5%8A%A8%E5%89%8D%E7%AB%AF\"><span class=\"toc-text\">启动前端</span></a></li></ol>","author":{"name":"Bug Designer","slug":"blog-author","avatar":"https://img-blog.csdnimg.cn/20210313122054101.png","link":"/","description":"<p><font face=\"微软雅黑\" color=\"red\"><b>QQ：2510472590</b></font></p><p><b>工作时间12:00 - 02:00</b></p>","socials":{"github":"https://github.com/sdzczh","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"https://blog.csdn.net/zgsdzczh?type=blog","juejin":"","customs":{}}},"mapped":true,"prev_post":{"title":"带你走进神秘的工厂合约|工厂合约解密|使用合约部署合约","uid":"42fb76be7720e85dee7cce126907c41c","slug":"带你走进神秘的工厂合约-工厂合约解密-使用合约部署合约/index","date":"2022-04-05T07:53:00.000Z","updated":"2022-04-05T07:53:53.842Z","comments":true,"path":"api/articles/带你走进神秘的工厂合约-工厂合约解密-使用合约部署合约/index.json","keywords":null,"cover":[],"text":" 工厂合约，顾名思义就是创建合约的工厂。 语法详解可以根据new关键字来创建合约new Contract() 示例&#x2F;&#x2F; SPDX-License-Identifier: MIT pragma solidity ^0.8.2; contract DemoCont...","link":"","photos":[],"count_time":{"symbolsCount":614,"symbolsTime":"1 mins."},"categories":[{"name":"Solidity","slug":"Solidity","count":5,"path":"api/categories/Solidity.json"}],"tags":[{"name":"区块链","slug":"区块链","count":13,"path":"api/tags/区块链.json"},{"name":"Solidity","slug":"Solidity","count":5,"path":"api/tags/Solidity.json"},{"name":"教程","slug":"教程","count":6,"path":"api/tags/教程.json"}],"author":{"name":"Bug Designer","slug":"blog-author","avatar":"https://img-blog.csdnimg.cn/20210313122054101.png","link":"/","description":"<p><font face=\"微软雅黑\" color=\"red\"><b>QQ：2510472590</b></font></p><p><b>工作时间12:00 - 02:00</b></p>","socials":{"github":"https://github.com/sdzczh","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"https://blog.csdn.net/zgsdzczh?type=blog","juejin":"","customs":{}}}},"next_post":{"title":"一些简单的 Gas 优化基础","uid":"743b68934be546ac8b4b7cd46c619570","slug":"一些简单的-Gas-优化基础/index","date":"2022-03-24T13:28:30.000Z","updated":"2022-03-24T16:26:30.874Z","comments":true,"path":"api/articles/一些简单的-Gas-优化基础/index.json","keywords":null,"cover":null,"text":"编写智能合约是很难的。不仅是要确保代码没有漏洞，而且你的编写方式还会影响到用户与它交互时的开销。 当你在编译智能合约时，每一行 Solidity 代码都会转换为一系列的操作(操作码)，这些操作都有对应的 gas 消耗。你的目标就是要让你的程序使用尽可能少的操作码(或者用更便宜的)...","link":"","photos":[],"count_time":{"symbolsCount":"3.9k","symbolsTime":"4 mins."},"categories":[{"name":"Solidity","slug":"Solidity","count":5,"path":"api/categories/Solidity.json"}],"tags":[{"name":"区块链","slug":"区块链","count":13,"path":"api/tags/区块链.json"},{"name":"百科","slug":"百科","count":2,"path":"api/tags/百科.json"}],"author":{"name":"Bug Designer","slug":"blog-author","avatar":"https://img-blog.csdnimg.cn/20210313122054101.png","link":"/","description":"<p><font face=\"微软雅黑\" color=\"red\"><b>QQ：2510472590</b></font></p><p><b>工作时间12:00 - 02:00</b></p>","socials":{"github":"https://github.com/sdzczh","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"https://blog.csdn.net/zgsdzczh?type=blog","juejin":"","customs":{}}}}}